"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[560],{3940:(t,e,a)=>{a.d(e,{$k:()=>c,RY:()=>s,h$:()=>u,iF:()=>i,mi:()=>o,tM:()=>d});var n=a(9708),l=a(4585),r=a(9285);let s=2;async function o(t){let e=await (0,r.Uc)(t);if(!e)return 0;let a=Date.now(),o=e.lastDrawRefill||a,i=a-o;if(i<432e5)return 0;let d=Math.floor(i/432e5),u=o+432e5*d,c=e.draws;if(c>=s){let e=(0,n.H9)(l.db,"users",t);return await (0,n.mZ)(e,{lastDrawRefill:u}),0}let w=Math.min(c+d,s),f=w-c;if(f>0){let e=(0,n.H9)(l.db,"users",t);await (0,n.mZ)(e,{draws:w,lastDrawRefill:u})}return f}async function i(t){let e=await (0,r.Uc)(t);if(e&&e.draws>0){let a={draws:e.draws-1};e.draws===s&&(a.lastDrawRefill=Date.now());let r=(0,n.H9)(l.db,"users",t);await (0,n.mZ)(r,a)}}async function d(t){let e=await (0,r.Uc)(t);if(e&&e.draws<s){let e=(0,n.H9)(l.db,"users",t);await (0,n.mZ)(e,{draws:(0,n.GV)(1)})}}async function u(t){let e=await (0,r.Uc)(t);return!!e&&!!e.lastFreeDrawClaimed&&new Date(e.lastFreeDrawClaimed).toDateString()===new Date().toDateString()}async function c(t,e){let a=await (0,r.Uc)(t);if(!a)return{success:!1,newCount:0};let o=a.draws||0;if(o>=s)return{success:!1,newCount:o,reason:"max_draws"};if(!(null==e?void 0:e.bypassTimeCheck)&&await u(t))return{success:!1,newCount:o,reason:"already_claimed"};if((null==e?void 0:e.cost)&&a.gold<e.cost)return{success:!1,newCount:o,reason:"not_enough_gold"};let i=o+1,d=Date.now(),c=(0,n.H9)(l.db,"users",t),w={draws:i};return(null==e?void 0:e.bypassTimeCheck)||(w.lastFreeDrawClaimed=d),(null==e?void 0:e.cost)&&e.cost>0&&(w.gold=(0,n.GV)(-e.cost)),i===s&&(w.lastDrawRefill=d),await (0,n.mZ)(c,w),{success:!0,newCount:i}}},4269:(t,e,a)=>{a.d(e,{cn:()=>r});var n=a(2821),l=a(5889);function r(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];return(0,l.QP)((0,n.$)(e))}},4585:(t,e,a)=>{a.d(e,{db:()=>i,j:()=>o});var n=a(2078),l=a(9253),r=a(9708);let s=(0,n.Dk)().length?(0,n.Sx)():(0,n.Wp)({apiKey:"AIzaSyBxgn4A1fMUdIwUKdDh4KWyjJTSle2dXQE",authDomain:"plentyofplants-108e8.firebaseapp.com",projectId:"plentyofplants-108e8",storageBucket:"plentyofplants-108e8.appspot.com",messagingSenderId:"317861154450",appId:"1:317861154450:web:3a586f3cc5b1c42e64e04b"}),o=(0,l.xI)(s),i=(0,r.aU)(s)},9285:(t,e,a)=>{a.d(e,{F$:()=>y,FQ:()=>P,Gg:()=>v,JS:()=>g,Jt:()=>d,R:()=>E,U3:()=>p,Uc:()=>i,VI:()=>D,VS:()=>u,VZ:()=>U,Z8:()=>f,Zk:()=>C,eL:()=>h,hj:()=>c,k_:()=>m,pv:()=>I,tj:()=>w,uM:()=>k,vV:()=>b,w:()=>Z,xW:()=>H,zw:()=>G});var n=a(9708),l=a(4585),r=a(3940),s=a(1929);function o(t){let e=new Date,a=new Date(t);return a.getDate()===e.getDate()&&a.getMonth()===e.getMonth()&&a.getFullYear()===e.getFullYear()}async function i(t){let e=(0,n.H9)(l.db,"users",t),a=await (0,n.x7)(e);if(!a.exists())return null;{var s;let t=a.data(),e=t.likedUsers||{};return Array.isArray(t.likedUsers)&&(e=t.likedUsers.reduce((t,e)=>(t[e]=1,t),{})),{gold:t.gold||0,plants:t.plants||{},collectionPlantIds:t.collectionPlantIds||[],deskPlantIds:t.deskPlantIds||[,,,].fill(null),gardenPlantIds:t.gardenPlantIds||Array(12).fill(null),seeds:t.seeds||[],draws:null!=(s=t.draws)?s:r.RY,lastDrawRefill:t.lastDrawRefill||Date.now(),lastFreeDrawClaimed:t.lastFreeDrawClaimed||0,lastLoginBonusClaimed:t.lastLoginBonusClaimed||0,sprinklerUnlocked:t.sprinklerUnlocked||!1,glitterCount:t.glitterCount||0,sheenCount:t.sheenCount||0,rainbowGlitterCount:t.rainbowGlitterCount||0,redGlitterCount:t.redGlitterCount||0,fertilizerCount:t.fertilizerCount||0,showcasePlantIds:t.showcasePlantIds||[],challenges:t.challenges||{},challengesStartDate:t.challengesStartDate||0,likes:t.likes||0,likedUsers:e,autoWaterUnlocked:t.autoWaterUnlocked||!1,autoWaterEnabled:t.autoWaterEnabled||!1,waterRefillCount:t.waterRefillCount||0,rubyCount:t.rubyCount||0,plantChatTokens:t.plantChatTokens||0}}}async function d(t){let e=(0,n.H9)(l.db,"users",t.uid);if(!(await (0,n.x7)(e)).exists()){let a=Math.floor(360*Math.random()),l={gold:20,plants:{1:{id:1,name:"Friendly Fern",description:"A happy little fern to start your collection.",image:"/fern.png",baseImage:"",uncompressedImage:"/fern.png",form:"Base",hint:"fern plant",level:1,xp:0,lastWatered:[],hasGlitter:!1,hasSheen:!1,hasRainbowGlitter:!1,hasRedGlitter:!1,personality:"",chatEnabled:!1,conversationHistory:[]}},collectionPlantIds:[],deskPlantIds:[,,,].fill(null),gardenPlantIds:Array(12).fill(null),seeds:[],draws:r.RY,lastDrawRefill:Date.now(),lastFreeDrawClaimed:0,lastLoginBonusClaimed:Date.now(),sprinklerUnlocked:!1,glitterCount:0,sheenCount:0,rainbowGlitterCount:0,redGlitterCount:0,fertilizerCount:0,showcasePlantIds:[],challenges:{},challengesStartDate:Date.now(),likes:0,likedUsers:{},autoWaterUnlocked:!1,autoWaterEnabled:!1,waterRefillCount:0,rubyCount:0,plantChatTokens:0};return l.deskPlantIds[0]=1,await (0,n.BN)(e,{email:t.email,username:t.displayName,avatarColor:"hsl(".concat(a,", 70%, 85%)"),gameId:"#".concat(t.uid.slice(0,8).toUpperCase()),...l}),l}return await i(t.uid)}async function u(t,e,a){let r=(0,n.H9)(l.db,"users",t),s=await i(t);if(!s)throw Error("User data not found, cannot save plant.");let o=Object.keys(s.plants).map(Number),d={id:(o.length>0?Math.max(...o):0)+1,name:e.name||"Mysterious Sprout",description:e.description||"A new plant has arrived.",image:e.imageDataUri||"",baseImage:"",uncompressedImage:a,form:"Base",hint:(e.name||"").toLowerCase().split(" ").slice(0,2).join(" "),level:1,xp:0,lastWatered:[],hasGlitter:!1,hasSheen:!1,hasRainbowGlitter:!1,hasRedGlitter:!1,personality:"",chatEnabled:!1,conversationHistory:[]},u=s.deskPlantIds.findIndex(t=>null===t),c={["plants.".concat(d.id)]:d};if(-1!==u){let t=[...s.deskPlantIds];t[u]=d.id,c.deskPlantIds=t}else c.collectionPlantIds=(0,n.hq)(d.id);return await (0,n.mZ)(r,c),d}async function c(t,e,a){await (0,n.mZ)((0,n.H9)(l.db,"users",t),{collectionPlantIds:e,deskPlantIds:a})}async function w(t,e,a){await (0,n.mZ)((0,n.H9)(l.db,"users",t),{collectionPlantIds:e,gardenPlantIds:a})}async function f(t,e,a){let r=(0,n.H9)(l.db,"users",t),s={};if(0===e)s={...a};else for(let[t,n]of Object.entries(a))s["plants.".concat(e,".").concat(t)]=n;Object.keys(s).length>0&&await (0,n.mZ)(r,s)}async function h(t,e){let a=(0,n.H9)(l.db,"users",t),r=await i(t);if(!r||r.gold<e)throw Error("Not enough gold to purchase.");if(r.sprinklerUnlocked)throw Error("Sprinkler already owned.");await (0,n.mZ)(a,{gold:(0,n.GV)(-e),sprinklerUnlocked:!0})}async function p(t){let e=(0,n.H9)(l.db,"users",t),a=await i(t);if(!a)throw Error("User data not found.");let r=Object.values(a.plants||{});if(0===r.length)return{plantsWatered:0,seedsCollected:0,newlyEvolvablePlants:[]};let d=0,u=[],c=[],w={};for(let t of r){let e=t.lastWatered.filter(o).length;if(e>=4)continue;let n=4-e,l=t.xp,r=t.level,i=r>=10&&"Base"===t.form||r>=25&&"Evolved"===t.form,f=[...t.lastWatered];for(let t=0;t<n;t++)for(f.push(Date.now()+t),l+=200;l>=1e3;)l-=1e3,r+=1,a.seeds.length+c.length<9&&c.push({id:(0,s.A)(),startTime:Date.now()});w["plants.".concat(t.id,".xp")]=l,w["plants.".concat(t.id,".level")]=r,w["plants.".concat(t.id,".lastWatered")]=f,(r>=10&&"Base"===t.form||r>=25&&"Evolved"===t.form)&&!i&&u.push(t.id),n>0&&d++}return d>0&&(c.length>0&&(w.seeds=(0,n.hq)(...c)),await (0,n.mZ)(e,w)),{plantsWatered:d,seedsCollected:c.length,newlyEvolvablePlants:u}}async function g(t,e,a,r){let s=(0,n.H9)(l.db,"users",t),o=await i(t);if(!o||o.gold<r)throw Error("Not enough gold to purchase.");await (0,n.mZ)(s,{gold:(0,n.GV)(-r),[e]:(0,n.GV)(a)})}async function m(t,e){let a=(0,n.H9)(l.db,"users",t),r=await i(t);if(!r||r.gold<e)throw Error("Not enough gold to purchase the bundle.");await (0,n.mZ)(a,{gold:(0,n.GV)(-e),glitterCount:(0,n.GV)(1),sheenCount:(0,n.GV)(1),rainbowGlitterCount:(0,n.GV)(1),redGlitterCount:(0,n.GV)(1),waterRefillCount:(0,n.GV)(1)})}async function b(t){let e=(0,n.H9)(l.db,"users",t),a=await i(t);if(!a||a.glitterCount<=0)throw Error("No glitter to use.");await (0,n.mZ)(e,{glitterCount:(0,n.GV)(-1)})}async function C(t){let e=(0,n.H9)(l.db,"users",t),a=await i(t);if(!a||a.sheenCount<=0)throw Error("No sheen packs to use.");await (0,n.mZ)(e,{sheenCount:(0,n.GV)(-1)})}async function y(t){let e=(0,n.H9)(l.db,"users",t),a=await i(t);if(!a||a.rainbowGlitterCount<=0)throw Error("No rainbow glitter packs to use.");await (0,n.mZ)(e,{rainbowGlitterCount:(0,n.GV)(-1)})}async function k(t){let e=(0,n.H9)(l.db,"users",t),a=await i(t);if(!a||a.redGlitterCount<=0)throw Error("No red glitter packs to use.");await (0,n.mZ)(e,{redGlitterCount:(0,n.GV)(-1)})}async function I(t,e){let a=(0,n.H9)(l.db,"users",t),r=await i(t);if(!r||!r.plants[e])throw Error("Plant not found for deletion.");let{["".concat(e)]:s,...o}=r.plants,d=r.deskPlantIds.map(t=>t===e?null:t),u=r.gardenPlantIds.map(t=>t===e?null:t),c=r.collectionPlantIds.filter(t=>t!==e),w=r.showcasePlantIds.filter(t=>t!==e);await (0,n.mZ)(a,{plants:o,deskPlantIds:d,gardenPlantIds:u,collectionPlantIds:c,showcasePlantIds:w})}async function G(t,e){let a=(0,n.H9)(l.db,"users",t);await (0,n.mZ)(a,{showcasePlantIds:e})}async function D(t,e){let a=(0,n.H9)(l.db,"users",t),r=(0,n.H9)(l.db,"users",e),s=await i(t);if(!s)throw Error("Liker data not found.");if(t===e)throw Error("You cannot like yourself.");let o=Date.now(),d=s.likedUsers[e];if(d&&o-d<864e5)throw Error("You have already liked this user today.");let u=(0,n.wP)(l.db);u.update(a,{["likedUsers.".concat(e)]:o}),u.update(r,{likes:(0,n.GV)(1),gold:(0,n.GV)(5)}),await u.commit()}async function P(t,e){let a=(0,n.H9)(l.db,"users",t),r=await i(t);if(!r||r.gold<e)throw Error("Not enough gold to purchase.");await (0,n.mZ)(a,{gold:(0,n.GV)(-e),waterRefillCount:(0,n.GV)(1)})}async function E(t,e){let a=(0,n.H9)(l.db,"users",t),r=await i(t);if(!r||r.rubyCount<e)throw Error("Not enough rubies to purchase.");await (0,n.mZ)(a,{rubyCount:(0,n.GV)(-e),plantChatTokens:(0,n.GV)(1)})}async function v(t,e){let a=(0,n.H9)(l.db,"users",t),r=await i(t);if(!r||r.plantChatTokens<=0)throw Error("You don't have a Plant Chat token to use.");let s=r.plants[e];if(!s)throw Error("Plant not found.");if(s.chatEnabled)throw Error("Chat is already unlocked for this plant.");await (0,n.mZ)(a,{plantChatTokens:(0,n.GV)(-1),["plants.".concat(e,".chatEnabled")]:!0})}async function H(t,e,a,r){let s=(0,n.H9)(l.db,"users",t);await (0,n.mZ)(s,{["plants.".concat(e,".conversationHistory")]:(0,n.hq)({role:"user",content:a},{role:"model",content:r})})}async function U(t,e){let a=(0,n.H9)(l.db,"users",t),r=await i(t);if(!r||!r.seeds)return;let s=r.seeds.find(t=>t.id===e);s&&await (0,n.mZ)(a,{seeds:(0,n.C3)(s)})}async function Z(t,e){let a=(0,n.H9)(l.db,"users",t),r=await i(t);if(!r||r.fertilizerCount<=0)throw Error("No fertilizer available.");let s=r.seeds.find(t=>t.id===e);if(!s)throw Error("Seed not found.");let o=s.startTime-288e5,d=r.seeds.map(t=>t.id===e?{...t,startTime:o}:t);await (0,n.mZ)(a,{fertilizerCount:(0,n.GV)(-1),seeds:d})}}}]);