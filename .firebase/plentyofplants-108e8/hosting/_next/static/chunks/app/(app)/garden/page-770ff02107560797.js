(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[242],{968:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});let l=(0,a(1847).A)("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]])},1847:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var l=a(2115);let r=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&a.indexOf(e)===t).join(" ")};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,l.forwardRef)((e,t)=>{let{color:a="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...h}=e;return(0,l.createElement)("svg",{ref:t,...s,width:n,height:n,stroke:a,strokeWidth:o?24*Number(i)/Number(n):i,className:r("lucide",c),...h},[...u.map(e=>{let[t,a]=e;return(0,l.createElement)(t,a)}),...Array.isArray(d)?d:[d]])}),i=(e,t)=>{let a=(0,l.forwardRef)((a,s)=>{let{className:i,...o}=a;return(0,l.createElement)(n,{ref:s,iconNode:t,className:r("lucide-".concat(e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),i),...o})});return a.displayName="".concat(e),a}},2054:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var l=a(5155),r=a(2115),s=a(3998),n=a(6948),i=a(1503);let o=(0,a(1847).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var c=a(5299),d=a(5958),u=a(968),h=a(5239),m=a(5894),p=a(4269),x=a(9689),g=a(4901),f=a(9285),w=a(233),v=a(8138),j=a(2619),y=a.n(j);function b(e){let{plant:t,onClick:a,processedImage:r,className:s}=e;return(0,l.jsx)(n.Zp,{className:(0,p.cn)("group overflow-hidden shadow-md w-full h-[120px] sm:h-[140px] relative cursor-pointer bg-white/70 backdrop-blur-sm",s),onClick:()=>a(t),children:(0,l.jsxs)(n.Wu,{className:"p-0 flex flex-col h-full",children:[(0,l.jsx)("div",{className:"flex-grow relative flex items-center justify-center bg-black/10",children:r&&"placeholder"!==r?(0,l.jsx)(h.default,{src:r,alt:t.name,fill:!0,sizes:"100px",className:"object-contain p-1","data-ai-hint":t.hint}):"placeholder"!==t.image?(0,l.jsx)(h.default,{src:t.image,alt:t.name,fill:!0,sizes:"100px",className:"object-cover","data-ai-hint":t.hint}):(0,l.jsx)(i.A,{className:"w-1/2 h-1/2 text-muted-foreground/40"})}),(0,l.jsxs)("div",{className:"p-1 text-center space-y-0.5 shrink-0",children:[(0,l.jsx)("p",{className:"text-xs font-semibold text-primary truncate",children:t.name}),(0,l.jsxs)("div",{className:"text-[10px] text-muted-foreground",children:["Lvl ",t.level]})]})]})})}function k(e){let{onClick:t,className:a}=e;return(0,l.jsx)(n.Zp,{className:(0,p.cn)("group overflow-hidden shadow-md w-full h-[120px] sm:h-[140px] relative cursor-pointer bg-black/10 backdrop-blur-sm",a),onClick:t,children:(0,l.jsxs)(n.Wu,{className:"p-0 flex flex-col h-full",children:[(0,l.jsx)("div",{className:"flex-grow relative flex items-center justify-center border-2 border-dashed border-white/30",children:(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)(o,{className:"mx-auto h-8 w-8 text-white/70"})})}),(0,l.jsx)("div",{className:"p-1 text-center shrink-0",children:(0,l.jsx)("div",{className:"h-[28px]"})})]})})}function N(){let{user:e,gameData:t}=(0,g.A)(),{toast:a}=(0,m.dj)(),{playSfx:n}=(0,x.n)(),[o,j]=(0,r.useState)([]),[N,A]=(0,r.useState)([]),[C,S]=(0,r.useState)(null),[M,E]=(0,r.useState)(null),[I,P]=(0,r.useState)({}),[z,R]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(t){j(t.collectionPlantIds||[]);let e=t.gardenPlantIds||[];A(Array.from({length:12},(t,a)=>e[a]||null))}},[t]);let O=(0,r.useMemo)(()=>(null==t?void 0:t.plants)||{},[t]),L=(0,r.useMemo)(()=>N.map(e=>e?O[e]:null),[N,O]);(0,r.useEffect)(()=>{(async()=>{let e={};for(let t of L)if(t&&t.image)if(t.image.startsWith("/"))e[t.id]=t.image;else try{let a=await (0,v.x)(t.image);e[t.id]=a}catch(a){console.error("Failed to process image for plant:",t.id,a),e[t.id]=t.image}P(e)})()},[L]);let W=(0,r.useMemo)(()=>o.map(e=>O[e]).filter(Boolean).sort((e,t)=>t.level-e.level),[o,O]),U=(0,r.useMemo)(()=>{let e=new Set(N.filter(e=>null!==e));return W.filter(t=>!e.has(t.id))},[W,N]),_=(e,t)=>{E({plantToReplaceId:e,gardenPlotIndex:t}),n("tap")},D=()=>{E(null)},$=async t=>{if(!M||!e)return;let{plantToReplaceId:l,gardenPlotIndex:r}=M,s=[...N],i=[...o];s[r]=t,i=i.filter(e=>e!==t),l&&i.push(l);try{await (0,f.tj)(e.uid,i,s),n("success"),a({title:"Garden Updated",description:"Your plant has been placed in the garden."})}catch(e){console.error("Failed to update garden arrangement",e),a({variant:"destructive",title:"Save Failed",description:"Could not save your garden changes."})}finally{D()}},F=async()=>{if(e){R(!0),n("watering");try{let{plantsWatered:t,seedsCollected:l,newlyEvolvablePlants:r}=await (0,f.U3)(e.uid);if(t>0){let e="You watered ".concat(t," plant(s).");l>0&&(e+=" You collected ".concat(l," new seed(s)!")),a({title:"Sprinkler Used!",description:e}),r.length>0&&setTimeout(()=>{a({title:"Plants Ready to Evolve!",description:"".concat(r.length," of your plants are now ready for evolution.")})},1e3)}else a({title:"All Plants Watered",description:"Your plants have already been fully watered for the day."})}catch(e){console.error("Failed to use sprinkler",e),a({variant:"destructive",title:"Error",description:e.message||"Could not use the sprinkler."})}finally{R(!1)}}};return e&&t?(0,l.jsxs)("div",{className:"min-h-screen bg-contain bg-bottom bg-no-repeat flex flex-col",style:{backgroundImage:"url('/garden-bg-sky.png')"},children:[(0,l.jsxs)("header",{className:"flex flex-col items-center gap-2 p-4 text-center bg-background/80 backdrop-blur-sm shrink-0",children:[(0,l.jsx)("h1",{className:"text-3xl text-primary font-bold",children:"My Garden"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Water your plants to help them grow. They might even evolve!"}),(0,l.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,l.jsx)(s.$,{asChild:!0,children:(0,l.jsxs)(y(),{href:"/garden",children:[(0,l.jsx)(i.A,{className:"mr-1.5 h-4 w-4"}),"Plants"]})}),(0,l.jsx)(s.$,{variant:"secondary",asChild:!0,children:(0,l.jsxs)(y(),{href:"/garden/seeds",children:[(0,l.jsx)(d.A,{className:"mr-1.5 h-4 w-4"}),"Seeds"]})}),t.sprinklerUnlocked&&(0,l.jsxs)(s.$,{onClick:F,disabled:z,className:"bg-blue-500 hover:bg-blue-600",children:[z?(0,l.jsx)(c.A,{className:"animate-spin"}):(0,l.jsx)(u.A,{className:"mr-1.5 h-4 w-4"}),"Sprinkler"]})]})]}),(0,l.jsx)("main",{className:"flex-grow flex flex-col justify-end p-2",children:(0,l.jsxs)("div",{className:"w-full max-w-4xl mx-auto relative",children:[(0,l.jsx)(h.default,{src:"/garden-bg.png",alt:"Garden plots",width:1024,height:512,className:"w-full h-auto"}),(0,l.jsx)("div",{className:"absolute inset-0 top-[5%] left-[4%] right-[4%] bottom-[10%]",children:(0,l.jsx)("div",{className:"grid grid-cols-3 grid-rows-4 h-full w-full gap-x-[8%] gap-y-[10%]",children:L.map((e,t)=>{let a=t<6;return e?(0,l.jsx)(b,{plant:e,onClick:()=>{var t;return t=O[e.id],void(S(O[t.id]),n("tap"))},processedImage:e?I[e.id]:null,className:(0,p.cn)(a&&"mt-[-5px]")},e.id):(0,l.jsx)(k,{onClick:()=>_(null,t),className:(0,p.cn)(a&&"mt-[-5px]")},"empty-".concat(t))})})})]})}),C&&(0,l.jsx)(w.Rx,{plant:O[C.id],open:!!C,onOpenChange:e=>!e&&S(null),onStartEvolution:()=>{},onSwapRequest:(e,t)=>_(e,t)}),M&&(0,l.jsx)(w.Tn,{open:!!M,onOpenChange:D,collectionPlants:U,onSelectPlant:$})]}):(0,l.jsx)("div",{className:"flex h-screen w-full items-center justify-center bg-white",children:(0,l.jsx)(c.A,{className:"h-8 w-8 animate-spin text-primary"})})}},5299:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});let l=(0,a(1847).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},5520:(e,t,a)=>{Promise.resolve().then(a.bind(a,2054))},5958:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});let l=(0,a(1847).A)("Sprout",[["path",{d:"M7 20h10",key:"e6iznv"}],["path",{d:"M10 20c5.5-2.5.8-6.4 3-10",key:"161w41"}],["path",{d:"M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z",key:"9gtqwd"}],["path",{d:"M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z",key:"bkxnd2"}]])},8138:(e,t,a)=>{"use strict";async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;return new Promise((a,l)=>{let r=new window.Image;r.crossOrigin="anonymous",r.onload=()=>{let e=document.createElement("canvas"),{width:s,height:n}=r;s>n?s>t&&(n=Math.round(n*t/s),s=t):n>t&&(s=Math.round(s*t/n),n=t),e.width=s,e.height=n;let i=e.getContext("2d");if(!i)return l(Error("Could not get canvas context"));i.drawImage(r,0,0,s,n),a(e.toDataURL("image/jpeg",.8))},r.onerror=l,r.src=e})}async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:240;return new Promise((a,l)=>{let r=new window.Image;r.crossOrigin="anonymous",r.onload=()=>{let e=document.createElement("canvas"),{width:s,height:n}=r;e.width=s,e.height=n;let i=e.getContext("2d");if(!i)return l(Error("Could not get canvas context"));i.drawImage(r,0,0);let o=i.getImageData(0,0,s,n),c=o.data;for(let e=0;e<c.length;e+=4){let a=c[e],l=c[e+1],r=c[e+2];a>t&&l>t&&r>t&&(c[e+3]=0)}i.putImageData(o,0,0),a(e.toDataURL("image/png"))},r.onerror=t=>{console.warn("CORS or other error making background transparent, returning original image",t),a(e)},r.src=e})}a.d(t,{w:()=>l,x:()=>r})}},e=>{e.O(0,[992,416,909,382,619,39,476,667,806,560,35,233,441,255,358],()=>e(e.s=5520)),_N_E=e.O()}]);