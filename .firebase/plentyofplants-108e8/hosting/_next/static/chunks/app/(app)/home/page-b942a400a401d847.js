(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[539],{991:(e,t,s)=>{"use strict";s.d(t,{k:()=>i});var a=s(5155),l=s(2115),r=s(9484),n=s(4269);let i=l.forwardRef((e,t)=>{let{className:s,value:l,...i}=e;return(0,a.jsx)(r.bL,{ref:t,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...i,children:(0,a.jsx)(r.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});i.displayName=r.bL.displayName},2464:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>T});var a=s(5155),l=s(3998),r=s(6948),n=s(1169),i=s(2472),o=s(5958),c=s(5299),d=s(5917),u=s(8055),h=s(5870),m=s(508),x=s(1503),f=s(5229),p=s(6983),g=s(3327),j=s(2619),w=s.n(j),N=s(5239),v=s(2115),y=s(5894),C=s(1834),b=s(4269),S=s(3940),A=s(9689),I=s(991),R=s(4901),k=s(9285),G=s(8138),D=s(4760),O=s(2739),E=s(1700),P=s(8072),M=s(5626),L=s(2987);let z=v.createContext(null);function $(){let e=v.useContext(z);if(!e)throw Error("useCarousel must be used within a <Carousel />");return e}let _=v.forwardRef((e,t)=>{let{orientation:s="horizontal",opts:l,setApi:r,plugins:n,className:i,children:o,...c}=e,[d,u]=(0,P.A)({...l,axis:"horizontal"===s?"x":"y"},n),[h,m]=v.useState(!1),[x,f]=v.useState(!1),p=v.useCallback(e=>{e&&(m(e.canScrollPrev()),f(e.canScrollNext()))},[]),g=v.useCallback(()=>{null==u||u.scrollPrev()},[u]),j=v.useCallback(()=>{null==u||u.scrollNext()},[u]),w=v.useCallback(e=>{"ArrowLeft"===e.key?(e.preventDefault(),g()):"ArrowRight"===e.key&&(e.preventDefault(),j())},[g,j]);return v.useEffect(()=>{u&&r&&r(u)},[u,r]),v.useEffect(()=>{if(u)return p(u),u.on("reInit",p),u.on("select",p),()=>{null==u||u.off("select",p)}},[u,p]),(0,a.jsx)(z.Provider,{value:{carouselRef:d,api:u,opts:l,orientation:s||((null==l?void 0:l.axis)==="y"?"vertical":"horizontal"),scrollPrev:g,scrollNext:j,canScrollPrev:h,canScrollNext:x},children:(0,a.jsx)("div",{ref:t,onKeyDownCapture:w,className:(0,b.cn)("relative",i),role:"region","aria-roledescription":"carousel",...c,children:o})})});_.displayName="Carousel";let U=v.forwardRef((e,t)=>{let{className:s,...l}=e,{carouselRef:r,orientation:n}=$();return(0,a.jsx)("div",{ref:r,className:"overflow-hidden",children:(0,a.jsx)("div",{ref:t,className:(0,b.cn)("flex","horizontal"===n?"-ml-4":"-mt-4 flex-col",s),...l})})});U.displayName="CarouselContent";let Y=v.forwardRef((e,t)=>{let{className:s,...l}=e,{orientation:r}=$();return(0,a.jsx)("div",{ref:t,role:"group","aria-roledescription":"slide",className:(0,b.cn)("min-w-0 shrink-0 grow-0 basis-full","horizontal"===r?"pl-4":"pt-4",s),...l})});Y.displayName="CarouselItem",v.forwardRef((e,t)=>{let{className:s,variant:r="outline",size:n="icon",...i}=e,{orientation:o,scrollPrev:c,canScrollPrev:d}=$();return(0,a.jsxs)(l.$,{ref:t,variant:r,size:n,className:(0,b.cn)("absolute  h-8 w-8 rounded-full","horizontal"===o?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!d,onClick:c,...i,children:[(0,a.jsx)(M.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Previous slide"})]})}).displayName="CarouselPrevious",v.forwardRef((e,t)=>{let{className:s,variant:r="outline",size:n="icon",...i}=e,{orientation:o,scrollNext:c,canScrollNext:d}=$();return(0,a.jsxs)(l.$,{ref:t,variant:r,size:n,className:(0,b.cn)("absolute h-8 w-8 rounded-full","horizontal"===o?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!d,onClick:c,...i,children:[(0,a.jsx)(L.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Next slide"})]})}).displayName="CarouselNext";var F=s(63);function Z(e){let{plant:t,open:s,onOpenChange:r}=e;return t?(0,a.jsx)(C.lG,{open:s,onOpenChange:r,children:(0,a.jsxs)(C.Cf,{className:"max-w-sm",children:[(0,a.jsx)(C.c7,{children:(0,a.jsx)(C.L3,{className:"text-3xl text-center",children:"A new plant!"})}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 py-4",children:[(0,a.jsx)("div",{className:"w-64 h-64 rounded-lg overflow-hidden border-4 border-primary/50 shadow-lg bg-green-100",children:(0,a.jsx)(N.default,{src:t.imageDataUri,alt:t.name,width:256,height:256,className:"object-cover w-full h-full"})}),(0,a.jsx)("h3",{className:"text-2xl font-semibold text-primary",children:t.name}),(0,a.jsx)("p",{className:"text-muted-foreground text-center",children:t.description})]}),(0,a.jsx)(C.Es,{children:(0,a.jsx)(C.HM,{asChild:!0,children:(0,a.jsx)(l.$,{className:"w-full text-lg",children:"Collect"})})})]})}):null}function H(e){let{open:t,onOpenChange:s}=e,r=(0,F.useRouter)();return(0,a.jsx)(C.lG,{open:t,onOpenChange:s,children:(0,a.jsxs)(C.Cf,{className:"max-w-sm",children:[(0,a.jsxs)(C.c7,{children:[(0,a.jsx)("div",{className:"mx-auto bg-accent rounded-full p-3 mb-2",children:(0,a.jsx)(n.A,{className:"h-8 w-8 text-accent-foreground"})}),(0,a.jsx)(C.L3,{className:"text-2xl text-center",children:"New: The Community Page!"}),(0,a.jsxs)(C.rr,{className:"text-center pt-2",children:["Check out the new Community page to see what other players are growing. You can like their showcases to give them 5 gold!",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"Go to your Profile to select which of your own plants you want to show off."]})]}),(0,a.jsxs)(C.Es,{className:"gap-2 sm:gap-0",children:[(0,a.jsx)(l.$,{variant:"outline",onClick:()=>{r.push("/profile"),s(!1)},children:"Go to Profile"}),(0,a.jsx)(C.HM,{asChild:!0,children:(0,a.jsx)(l.$,{children:"Got it!"})})]})]})})}function B(e){let{open:t,onOpenChange:s}=e;return(0,a.jsx)(C.lG,{open:t,onOpenChange:s,children:(0,a.jsxs)(C.Cf,{className:"max-w-sm",children:[(0,a.jsxs)(C.c7,{children:[(0,a.jsx)("div",{className:"mx-auto bg-accent rounded-full p-3 mb-2",children:(0,a.jsx)(i.A,{className:"h-8 w-8 text-accent-foreground"})}),(0,a.jsx)(C.L3,{className:"text-2xl text-center",children:"New Game Updates!"}),(0,a.jsxs)(C.rr,{className:"text-center pt-2",children:["Keep the streak going! After you complete all your daily challenges, a new set of **Bonus Challenges** will now appear.",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"Complete them for even more rewards!"]})]}),(0,a.jsx)(C.Es,{children:(0,a.jsx)(C.HM,{asChild:!0,children:(0,a.jsx)(l.$,{className:"w-full",children:"Awesome!"})})})]})})}function K(e){let{open:t,onOpenChange:s}=e,r=(0,F.useRouter)();return(0,a.jsx)(C.lG,{open:t,onOpenChange:s,children:(0,a.jsxs)(C.Cf,{className:"max-w-sm",children:[(0,a.jsxs)(C.c7,{children:[(0,a.jsx)("div",{className:"mx-auto bg-accent rounded-full p-3 mb-2",children:(0,a.jsx)(o.A,{className:"h-8 w-8 text-accent-foreground"})}),(0,a.jsx)(C.L3,{className:"text-2xl text-center",children:"Watering Has Moved!"}),(0,a.jsx)(C.rr,{className:"text-center pt-2",children:"All your plant care, including watering and evolution, now happens in the new **Garden** page. Visit your garden to help your plants grow!"})]}),(0,a.jsxs)(C.Es,{className:"gap-2 sm:gap-0",children:[(0,a.jsx)(l.$,{variant:"outline",onClick:()=>{r.push("/garden"),s(!1)},children:"Go to Garden"}),(0,a.jsx)(C.HM,{asChild:!0,children:(0,a.jsx)(l.$,{children:"Got it!"})})]})]})})}function W(e){let{challenge:t,onClaim:s,isClaiming:r}=e,n=t.progress>=t.target;return(0,a.jsxs)("div",{className:"flex items-center gap-4 p-3 rounded-lg bg-muted/50",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("p",{className:"font-semibold text-primary",children:t.title}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:t.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(I.k,{value:t.progress/t.target*100,className:"h-2 w-full"}),(0,a.jsxs)("span",{className:"text-xs font-mono text-muted-foreground",children:[t.progress,"/",t.target]})]})]}),(0,a.jsx)(l.$,{onClick:()=>s(t.id),disabled:!n||t.claimed||r,size:"sm",children:r?(0,a.jsx)(c.A,{className:"animate-spin"}):t.claimed?(0,a.jsx)(d.A,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"mr-1 h-3 w-3"})," ",t.reward]})})]})}let J=["Go to the Garden to water your plants and help them grow.","Drag plants from your collection onto the plots in your garden to display them.","Complete daily challenges to earn extra gold.","Visit the shop to get daily free draws or buy more with your gold.","Show off your favorite plants on the community page by selecting them in your profile."];function T(){let{user:e,gameData:t}=(0,R.A)(),{toast:s}=(0,y.dj)(),{playSfx:n}=(0,A.n)();(0,F.useRouter)();let[o,u]=(0,v.useState)(null),[j,C]=(0,v.useState)(!1),[P,M]=(0,v.useState)(null),[L,z]=(0,v.useState)(null),[$,T]=(0,v.useState)(!1),[V,X]=(0,v.useState)(""),[q,Q]=(0,v.useState)(!1),[ee,et]=(0,v.useState)(!1),[es,ea]=(0,v.useState)(!1),el=(0,v.useRef)((0,E.A)({delay:4e3,stopOnInteraction:!0}));(0,v.useEffect)(()=>{e&&t&&((0,S.mi)(e.uid).then(e=>{e>0&&s({title:"Draws Refilled!",description:"You got ".concat(e," new draw(s).")})}),(0,O.LH)(e.uid).then(()=>{(0,O.yn)(e.uid)}),localStorage.getItem("hasSeenCommunityInfo")||Q(!0),localStorage.getItem("hasSeenGameChangesInfo_v1")||et(!0),localStorage.getItem("hasSeenGardenInfo_v1")||ea(!0))},[e,t,s]),(0,v.useEffect)(()=>{if(null==t?void 0:t.plants){let e=Object.values(t.plants);e.length>0?u(e.reduce((e,t)=>t.id>e.id?t:e,e[0])):u(null)}},[t]),(0,v.useEffect)(()=>{if(null==t?void 0:t.lastDrawRefill){let e=()=>{X(function(e){let t=Math.max(0,e+432e5-Date.now());if(0===t)return"Next draw available now!";let s=Math.floor(t/36e5),a=Math.floor(t%36e5/6e4);return"".concat(s,"h ").concat(a,"m until next draw")}(t.lastDrawRefill))};e();let s=setInterval(e,6e4);return()=>clearInterval(s)}},[null==t?void 0:t.lastDrawRefill]);let er=async()=>{if(e){if(!t||t.draws<=0)return void s({variant:"destructive",title:"No Draws Left",description:"Visit the shop to get more draws or wait for your daily refill."});C(!0);try{await (0,S.iF)(e.uid);let s=t.plants?Object.values(t.plants).map(e=>e.name):[],a=await (0,D.G)(s);z(a.imageDataUri);let l=await (0,G.w)(a.imageDataUri);n("success"),M({...a,imageDataUri:l})}catch(t){console.error(t),await (0,S.tM)(e.uid),"Invalid API Key"===t.message?s({variant:"destructive",title:"Invalid API Key",description:"Please check your GOOGLE_API_KEY. Your draw has been refunded."}):s({variant:"destructive",title:"Failed to draw a plant",description:"There was an issue with the AI. Your draw has been refunded."})}finally{C(!1)}}},en=async()=>{if(P&&L&&e){try{let t=JSON.parse(JSON.stringify(P)),s=await (0,k.VS)(e.uid,t,L);u(s),await (0,O.JD)(e.uid)}catch(e){console.error("Failed to save plant to Firestore",e),s({variant:"destructive",title:"Storage Error",description:"Could not save your new plant."})}M(null),z(null)}},ei=async t=>{if(e){T(!0);try{await (0,O.XU)(e.uid,t),n("reward"),s({title:"Reward Claimed!",description:"You've earned some gold!"})}catch(e){console.error("Failed to claim challenge reward",e),s({variant:"destructive",title:"Claiming Error",description:e.message||"Could not claim your reward."})}finally{T(!1)}}},eo=(0,v.useMemo)(()=>!!(null==t?void 0:t.challenges)&&Object.values(O.dt).every(e=>{let s=t.challenges[e.id];return(null==s?void 0:s.claimed)||((null==s?void 0:s.progress)||0)>=e.target}),[null==t?void 0:t.challenges]),ec=eo?O.hJ:O.dt;if(!e||!t)return(0,a.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,a.jsx)(c.A,{className:"h-8 w-8 animate-spin text-primary"})});let ed=t.challenges;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-4 space-y-6 bg-white pb-[3.75rem]",children:[(0,a.jsxs)("header",{className:"flex flex-col items-center space-y-2",children:[(0,a.jsx)("h1",{className:"text-3xl text-primary font-bold text-center",children:"Plenty Of Plants"}),(0,a.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,a.jsx)(l.$,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)(w(),{href:"/settings",children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Settings"]})}),(0,a.jsx)(l.$,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)(w(),{href:"/profile",children:[(0,a.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Profile"]})})]})]}),(0,a.jsxs)("main",{className:"space-y-6",children:[(0,a.jsxs)(r.Zp,{className:"shadow-sm",children:[(0,a.jsx)(r.aR,{children:(0,a.jsx)(r.ZB,{className:"text-xl text-center",children:"Your Latest Plant"})}),(0,a.jsx)(r.Wu,{className:"flex flex-col items-center justify-center text-center min-h-[260px]",children:o?(0,a.jsxs)(w(),{href:"/garden",className:"flex flex-col items-center gap-2 transition-transform hover:scale-105",children:[(0,a.jsx)("div",{className:"w-48 h-48 rounded-lg overflow-hidden border-2 border-primary/30 shadow-md",children:"placeholder"!==o.image?(0,a.jsx)(N.default,{src:o.image,alt:o.name,width:192,height:192,className:"object-cover w-full h-full","data-ai-hint":o.hint}):(0,a.jsx)("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:(0,a.jsx)(x.A,{className:"w-16 h-16 text-muted-foreground"})})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-primary",children:o.name}),(0,a.jsx)("div",{className:"w-4/5",children:(0,a.jsx)(I.k,{value:o.xp/1e3*100,className:"h-2"})})]}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"No plants collected yet. Time to draw one!"})})]}),ed&&(0,a.jsxs)(r.Zp,{className:"shadow-sm",children:[(0,a.jsx)(r.aR,{children:(0,a.jsxs)(r.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(i.A,{className:"text-yellow-500"}),eo?"Bonus Challenges":"Daily Challenges"]})}),(0,a.jsx)(r.Wu,{className:"space-y-3",children:Object.values(ec).map(e=>{let t=ed[e.id]||{progress:0,claimed:!1},s={...e,...t};return(0,a.jsx)(W,{challenge:s,onClaim:ei,isClaiming:$},e.id)})})]}),(0,a.jsx)(r.Zp,{className:"shadow-sm",children:(0,a.jsxs)(r.Wu,{className:"flex flex-col items-center gap-4 pt-6",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)("div",{className:"flex items-center gap-3",children:Array.from({length:S.RY}).map((e,s)=>{let l=s<t.draws;return(0,a.jsx)("div",{className:(0,b.cn)("h-8 w-8 rounded-full flex items-center justify-center text-white shadow-inner",l?"bg-green-500":"bg-red-500"),children:l?(0,a.jsx)(d.A,{className:"h-5 w-5"}):(0,a.jsx)(f.A,{className:"h-5 w-5"})},s)})}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground text-center",children:[(0,a.jsx)("span",{children:"Draws Available"}),t.draws<S.RY&&V&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center justify-center gap-1.5 pt-1",children:[(0,a.jsx)(p.A,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:V})]})]})]}),(0,a.jsx)(l.$,{onClick:er,disabled:j||t.draws<=0,size:"lg",className:"w-full rounded-full mt-2",children:j?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Drawing..."]}):"Draw New Plant"})]})}),(0,a.jsxs)(r.Zp,{className:"shadow-sm",children:[(0,a.jsx)(r.aR,{children:(0,a.jsxs)(r.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(g.A,{className:"text-primary"}),"Game Tips"]})}),(0,a.jsx)(r.Wu,{children:(0,a.jsx)(_,{plugins:[el.current],opts:{align:"start",loop:!0},className:"w-full",onMouseEnter:()=>el.current.stop(),onMouseLeave:()=>el.current.reset(),children:(0,a.jsx)(U,{children:J.map((e,t)=>(0,a.jsx)(Y,{children:(0,a.jsx)("div",{className:"p-1 h-16 flex items-center justify-center",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:e})})},t))})})})]})]}),(0,a.jsx)(Z,{plant:P,open:!!P,onOpenChange:e=>{e||en()}}),(0,a.jsx)(H,{open:q,onOpenChange:e=>{e||(localStorage.setItem("hasSeenCommunityInfo","true"),Q(!1))}}),(0,a.jsx)(B,{open:ee,onOpenChange:e=>{e||(localStorage.setItem("hasSeenGameChangesInfo_v1","true"),et(!1))}}),(0,a.jsx)(K,{open:es,onOpenChange:e=>{e||(localStorage.setItem("hasSeenGardenInfo_v1","true"),ea(!1))}})]}),(0,a.jsx)("footer",{className:"text-center text-xs text-muted-foreground pb-2",children:(0,a.jsx)("p",{children:"\xa9 2025 Sky Mountain Graphics. All Rights Reserved."})})]})}},4760:(e,t,s)=>{"use strict";s.d(t,{G:()=>l});var a=s(926);let l=(0,a.createServerReference)("40d8950a3968c4b506ebafa8329e74b733520130ef",a.callServer,void 0,a.findSourceMapURL,"drawPlantAction")},5862:(e,t,s)=>{Promise.resolve().then(s.bind(s,2464))},8138:(e,t,s)=>{"use strict";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;return new Promise((s,a)=>{let l=new window.Image;l.crossOrigin="anonymous",l.onload=()=>{let e=document.createElement("canvas"),{width:r,height:n}=l;r>n?r>t&&(n=Math.round(n*t/r),r=t):n>t&&(r=Math.round(r*t/n),n=t),e.width=r,e.height=n;let i=e.getContext("2d");if(!i)return a(Error("Could not get canvas context"));i.drawImage(l,0,0,r,n),s(e.toDataURL("image/jpeg",.8))},l.onerror=a,l.src=e})}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:240;return new Promise((s,a)=>{let l=new window.Image;l.crossOrigin="anonymous",l.onload=()=>{let e=document.createElement("canvas"),{width:r,height:n}=l;e.width=r,e.height=n;let i=e.getContext("2d");if(!i)return a(Error("Could not get canvas context"));i.drawImage(l,0,0);let o=i.getImageData(0,0,r,n),c=o.data;for(let e=0;e<c.length;e+=4){let s=c[e],a=c[e+1],l=c[e+2];s>t&&a>t&&l>t&&(c[e+3]=0)}i.putImageData(o,0,0),s(e.toDataURL("image/png"))},l.onerror=t=>{console.warn("CORS or other error making background transparent, returning original image",t),s(e)},l.src=e})}s.d(t,{w:()=>a,x:()=>l})}},e=>{e.O(0,[992,416,909,382,619,39,476,667,259,560,35,441,255,358],()=>e(e.s=5862)),_N_E=e.O()}]);