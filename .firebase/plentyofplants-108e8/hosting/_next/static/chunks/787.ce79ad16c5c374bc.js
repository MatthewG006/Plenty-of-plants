"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[787],{787:(e,s,t)=>{t.r(s),t.d(s,{default:()=>A});var a=t(5155),r=t(2115),n=t(3998),c=t(6948),l=t(5626),i=t(5299),o=t(7801),d=t(6826),m=t(1169),x=t(6983),h=t(6613),u=t(5894),p=t(9689),f=t(4901),j=t(926);let v=(0,j.createServerReference)("0093af131250d7e6ad2e4049d028fc90c8dcbaf3a8",j.callServer,void 0,j.findSourceMapURL,"cleanupExpiredContests"),N=(0,j.createServerReference)("009d9a32772cdb888b206c4cd6e907f985be380bf9",j.callServer,void 0,j.findSourceMapURL,"getActiveContests"),y=(0,j.createServerReference)("70ecf2fa33444e20ade17fdb1c17b64129d0cfa489",j.callServer,void 0,j.findSourceMapURL,"createNewContest");var w=t(2619),b=t.n(w),C=t(5584),g=t(63),S=t(8260);function A(){let{user:e,gameData:s}=(0,f.A)(),{toast:t}=(0,u.dj)(),{playSfx:j}=(0,p.n)(),w=(0,g.useRouter)(),[A,R]=(0,r.useState)(!0),[E,k]=(0,r.useState)(!1),[B,L]=(0,r.useState)(null),[Z,F]=(0,r.useState)([]),[T,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{async function e(){R(!0),L(null);try{await v();let e=await N();F(e)}catch(e){console.error("Failed to load contests:",e),L(e.message||"Could not load active contests."),t({variant:"destructive",title:"Loading Error",description:e.message})}finally{R(!1)}}e();let s=setInterval(e,3e4);return()=>clearInterval(s)},[t]);let I=async s=>{if(e&&e.displayName){_(!1),k(!0),L(null);try{let{sessionId:a,error:r}=await y(e.uid,e.displayName,s);if(r)throw Error(r);if(a)t({title:"Contest Created!",description:"Your new contest lobby is now open."}),w.push("/community/contest/".concat(a));else throw Error("Failed to get a session ID from the server.")}catch(e){console.error("Failed to start contest:",e),L(e.message||"Failed to start a new contest."),t({variant:"destructive",title:"Contest Creation Error",description:e.message})}finally{k(!1)}}};return(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between pb-4",children:[(0,a.jsx)(n.$,{asChild:!0,variant:"ghost",size:"icon",children:(0,a.jsx)(b(),{href:"/community/park",children:(0,a.jsx)(l.A,{})})}),(0,a.jsx)("h1",{className:"text-2xl text-primary font-bold",children:"Contest Lobbies"}),(0,a.jsx)("div",{className:"w-10"})]}),A?(0,a.jsx)("div",{className:"flex justify-center pt-10",children:(0,a.jsx)(i.A,{className:"h-10 w-10 animate-spin text-primary"})}):B?(0,a.jsx)(c.Zp,{className:"m-4 text-center py-10 border-destructive",children:(0,a.jsxs)(c.aR,{children:[(0,a.jsx)("div",{className:"mx-auto bg-destructive/10 rounded-full w-fit p-3 mb-2",children:(0,a.jsx)(o.A,{className:"h-10 w-10 text-destructive"})}),(0,a.jsx)(c.ZB,{className:"text-destructive",children:"Contest Error"}),(0,a.jsx)(c.BT,{children:B})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.$,{onClick:()=>{e&&(j("tap"),_(!0))},disabled:E,className:"w-full text-lg",children:[E?(0,a.jsx)(i.A,{className:"animate-spin"}):(0,a.jsx)(d.A,{className:"mr-2"}),"Create New Contest"]}),(0,a.jsx)("div",{className:"space-y-4",children:Z.length>0?Z.map(e=>{let s=new Date(e.createdAt);return(0,a.jsxs)(c.Zp,{className:"hover:border-primary/50 transition-colors",children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsxs)(c.ZB,{children:[e.hostName,"'s Contest"]}),(0,a.jsxs)(c.BT,{className:"flex items-center gap-4 pt-1",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(m.A,{className:"w-4 h-4"})," ",e.contestantCount," / 4 players"]}),(0,a.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(x.A,{className:"w-4 h-4"})," Created ",(0,S.m)(s,{addSuffix:!0})]})]})]}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)(n.$,{asChild:!0,className:"w-full",children:(0,a.jsxs)(b(),{href:"/community/contest/".concat(e.id),children:[(0,a.jsx)(h.A,{className:"mr-2"}),"Join Lobby"]})})})]},e.id)}):(0,a.jsx)(c.Zp,{className:"text-center py-10",children:(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(h.A,{className:"w-16 h-16 mx-auto text-yellow-400"}),(0,a.jsx)(c.ZB,{className:"pt-4",children:"No Active Contests"}),(0,a.jsx)(c.BT,{children:"There aren't any contests running right now. Why not start one?"})]})})})]}),(0,a.jsx)(C.ir,{open:T,onOpenChange:_,allPlants:Object.values((null==s?void 0:s.plants)||{}),onSelectPlant:I})]})}}}]);