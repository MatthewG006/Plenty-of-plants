"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[184],{3940:(e,t,a)=>{a.d(t,{$k:()=>u,RY:()=>s,h$:()=>d,iF:()=>o,tM:()=>i});var n=a(9708),r=a(4585),l=a(9285);let s=2;async function o(e){let t=await (0,l.Uc)(e);if(t&&t.draws>0){let a={draws:t.draws-1};t.draws===s&&(a.lastDrawRefill=Date.now());let l=(0,n.H9)(r.db,"users",e);await (0,n.mZ)(l,a)}}async function i(e){let t=await (0,l.Uc)(e);if(t&&t.draws<s){let t=(0,n.H9)(r.db,"users",e);await (0,n.mZ)(t,{draws:(0,n.GV)(1)})}}async function d(e){let t=await (0,l.Uc)(e);return!!t&&!!t.lastFreeDrawClaimed&&new Date(t.lastFreeDrawClaimed).toDateString()===new Date().toDateString()}async function u(e,t){let a=await (0,l.Uc)(e);if(!a)return{success:!1,newCount:0};let o=a.draws||0;if(o>=s)return{success:!1,newCount:o,reason:"max_draws"};if(!(null==t?void 0:t.bypassTimeCheck)&&await d(e))return{success:!1,newCount:o,reason:"already_claimed"};if((null==t?void 0:t.cost)&&a.gold<t.cost)return{success:!1,newCount:o,reason:"not_enough_gold"};let i=o+1,u=Date.now(),c=(0,n.H9)(r.db,"users",e),w={draws:i};return(null==t?void 0:t.bypassTimeCheck)||(w.lastFreeDrawClaimed=u),(null==t?void 0:t.cost)&&t.cost>0&&(w.gold=(0,n.GV)(-t.cost)),i===s&&(w.lastDrawRefill=u),await (0,n.mZ)(c,w),{success:!0,newCount:i}}},4269:(e,t,a)=>{a.d(t,{cn:()=>l});var n=a(2821),r=a(5889);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,n.$)(t))}},4585:(e,t,a)=>{a.d(t,{db:()=>d,j2:()=>i});var n=a(2078),r=a(9253),l=a(9708),s=a(8134);let o=(0,n.Dk)().length?(0,n.Sx)():(0,n.Wp)({apiKey:"AIzaSyBxgn4A1fMUdIwUKdDh4KWyjJTSle2dXQE",authDomain:"plentyofplants-108e8.firebaseapp.com",projectId:"plentyofplants-108e8",storageBucket:"plentyofplants-108e8.appspot.com",messagingSenderId:"317861154450",appId:"1:317861154450:web:3a586f3cc5b1c42e64e04b"}),i=(0,r.xI)(o),d=(0,l.aU)(o);(0,s.c7)(o)},9285:(e,t,a)=>{a.d(t,{F$:()=>G,FQ:()=>D,Gg:()=>U,JS:()=>C,Jt:()=>c,Oh:()=>i,R:()=>H,U3:()=>g,Uc:()=>u,VI:()=>E,VS:()=>w,VZ:()=>x,Z8:()=>p,Zk:()=>k,aw:()=>o,eL:()=>m,hj:()=>f,k_:()=>b,pv:()=>v,tj:()=>h,uM:()=>I,vV:()=>y,w:()=>Z,xW:()=>V,zw:()=>P});var n=a(9708),r=a(4585),l=a(3940),s=a(1929);let o=3,i=12;function d(e){let t=new Date,a=new Date(e);return a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()}async function u(e){let t=(0,n.H9)(r.db,"users",e),a=await (0,n.x7)(t);if(!a.exists())return null;{var s;let e=a.data(),t=e.likedUsers||{};return Array.isArray(e.likedUsers)&&(t=e.likedUsers.reduce((e,t)=>(e[t]=1,e),{})),{gold:e.gold||0,plants:e.plants||{},collectionPlantIds:e.collectionPlantIds||[],deskPlantIds:e.deskPlantIds||Array(o).fill(null),gardenPlantIds:e.gardenPlantIds||Array(i).fill(null),seeds:e.seeds||[],draws:null!=(s=e.draws)?s:l.RY,lastDrawRefill:e.lastDrawRefill||Date.now(),lastFreeDrawClaimed:e.lastFreeDrawClaimed||0,lastLoginBonusClaimed:e.lastLoginBonusClaimed||0,sprinklerUnlocked:e.sprinklerUnlocked||!1,glitterCount:e.glitterCount||0,sheenCount:e.sheenCount||0,rainbowGlitterCount:e.rainbowGlitterCount||0,redGlitterCount:e.redGlitterCount||0,fertilizerCount:e.fertilizerCount||0,showcasePlantIds:e.showcasePlantIds||[],challenges:e.challenges||{},challengesStartDate:e.challengesStartDate||0,likes:e.likes||0,likedUsers:t,autoWaterUnlocked:e.autoWaterUnlocked||!1,autoWaterEnabled:e.autoWaterEnabled||!1,waterRefillCount:e.waterRefillCount||0,rubyCount:e.rubyCount||0,plantChatTokens:e.plantChatTokens||0}}}async function c(e){let t=(0,n.H9)(r.db,"users",e.uid);if(!(await (0,n.x7)(t)).exists()){let a=Math.floor(360*Math.random()),r={gold:20,plants:{1:{id:1,name:"Friendly Fern",description:"A happy little fern to start your collection.",image:"/fern.png",baseImage:"",uncompressedImage:"/fern.png",form:"Base",hint:"fern plant",level:1,xp:0,lastWatered:[],hasGlitter:!1,hasSheen:!1,hasRainbowGlitter:!1,hasRedGlitter:!1,personality:"",chatEnabled:!1,conversationHistory:[]}},collectionPlantIds:[],deskPlantIds:Array(o).fill(null),gardenPlantIds:Array(i).fill(null),seeds:[],draws:l.RY,lastDrawRefill:Date.now(),lastFreeDrawClaimed:0,lastLoginBonusClaimed:Date.now(),sprinklerUnlocked:!1,glitterCount:0,sheenCount:0,rainbowGlitterCount:0,redGlitterCount:0,fertilizerCount:0,showcasePlantIds:[],challenges:{},challengesStartDate:Date.now(),likes:0,likedUsers:{},autoWaterUnlocked:!1,autoWaterEnabled:!1,waterRefillCount:0,rubyCount:0,plantChatTokens:0};return r.deskPlantIds[0]=1,await (0,n.BN)(t,{email:e.email,username:e.displayName,avatarColor:"hsl(".concat(a,", 70%, 85%)"),gameId:"#".concat(e.uid.slice(0,8).toUpperCase()),...r}),r}return await u(e.uid)}async function w(e,t,a){let l=(0,n.H9)(r.db,"users",e),s=await u(e);if(!s)throw Error("User data not found, cannot save plant.");let o=Object.keys(s.plants).map(Number),i={id:(o.length>0?Math.max(...o):0)+1,name:t.name||"Mysterious Sprout",description:t.description||"A new plant has arrived.",image:t.imageDataUri||"",baseImage:"",uncompressedImage:a,form:"Base",hint:(t.name||"").toLowerCase().split(" ").slice(0,2).join(" "),level:1,xp:0,lastWatered:[],hasGlitter:!1,hasSheen:!1,hasRainbowGlitter:!1,hasRedGlitter:!1,personality:"",chatEnabled:!1,conversationHistory:[]},d=s.deskPlantIds.findIndex(e=>null===e),c={["plants.".concat(i.id)]:i};if(-1!==d){let e=[...s.deskPlantIds];e[d]=i.id,c.deskPlantIds=e}else c.collectionPlantIds=(0,n.hq)(i.id);return await (0,n.mZ)(l,c),i}async function f(e,t,a){await (0,n.mZ)((0,n.H9)(r.db,"users",e),{collectionPlantIds:t,deskPlantIds:a})}async function h(e,t,a){await (0,n.mZ)((0,n.H9)(r.db,"users",e),{collectionPlantIds:t,gardenPlantIds:a})}async function p(e,t,a){let l=(0,n.H9)(r.db,"users",e),s={};if(0===t)s={...a};else for(let[e,n]of Object.entries(a))s["plants.".concat(t,".").concat(e)]=n;Object.keys(s).length>0&&await (0,n.mZ)(l,s)}async function m(e,t){let a=(0,n.H9)(r.db,"users",e),l=await u(e);if(!l||l.gold<t)throw Error("Not enough gold to purchase.");if(l.sprinklerUnlocked)throw Error("Sprinkler already owned.");await (0,n.mZ)(a,{gold:(0,n.GV)(-t),sprinklerUnlocked:!0})}async function g(e){let t=(0,n.H9)(r.db,"users",e),a=await u(e);if(!a)throw Error("User data not found.");let l=Object.values(a.plants||{});if(0===l.length)return{plantsWatered:0,seedsCollected:0,newlyEvolvablePlants:[]};let o=0,i=[],c=[],w={};for(let e of l){let t=e.lastWatered.filter(d).length;if(t>=4)continue;let n=4-t,r=e.xp,l=e.level,u=l>=10&&"Base"===e.form||l>=25&&"Evolved"===e.form,f=[...e.lastWatered];for(let e=0;e<n;e++)for(f.push(Date.now()+e),r+=200;r>=1e3;)r-=1e3,l+=1,a.seeds.length+c.length<9&&c.push({id:(0,s.A)(),startTime:Date.now()});w["plants.".concat(e.id,".xp")]=r,w["plants.".concat(e.id,".level")]=l,w["plants.".concat(e.id,".lastWatered")]=f,(l>=10&&"Base"===e.form||l>=25&&"Evolved"===e.form)&&!u&&i.push(e.id),n>0&&o++}return o>0&&(c.length>0&&(w.seeds=(0,n.hq)(...c)),await (0,n.mZ)(t,w)),{plantsWatered:o,seedsCollected:c.length,newlyEvolvablePlants:i}}async function C(e,t,a,l){let s=(0,n.H9)(r.db,"users",e),o=await u(e);if(!o||o.gold<l)throw Error("Not enough gold to purchase.");await (0,n.mZ)(s,{gold:(0,n.GV)(-l),[t]:(0,n.GV)(a)})}async function b(e,t){let a=(0,n.H9)(r.db,"users",e),l=await u(e);if(!l||l.gold<t)throw Error("Not enough gold to purchase the bundle.");await (0,n.mZ)(a,{gold:(0,n.GV)(-t),glitterCount:(0,n.GV)(1),sheenCount:(0,n.GV)(1),rainbowGlitterCount:(0,n.GV)(1),redGlitterCount:(0,n.GV)(1),waterRefillCount:(0,n.GV)(1)})}async function y(e){let t=(0,n.H9)(r.db,"users",e),a=await u(e);if(!a||a.glitterCount<=0)throw Error("No glitter to use.");await (0,n.mZ)(t,{glitterCount:(0,n.GV)(-1)})}async function k(e){let t=(0,n.H9)(r.db,"users",e),a=await u(e);if(!a||a.sheenCount<=0)throw Error("No sheen packs to use.");await (0,n.mZ)(t,{sheenCount:(0,n.GV)(-1)})}async function G(e){let t=(0,n.H9)(r.db,"users",e),a=await u(e);if(!a||a.rainbowGlitterCount<=0)throw Error("No rainbow glitter packs to use.");await (0,n.mZ)(t,{rainbowGlitterCount:(0,n.GV)(-1)})}async function I(e){let t=(0,n.H9)(r.db,"users",e),a=await u(e);if(!a||a.redGlitterCount<=0)throw Error("No red glitter packs to use.");await (0,n.mZ)(t,{redGlitterCount:(0,n.GV)(-1)})}async function v(e,t){let a=(0,n.H9)(r.db,"users",e),l=await u(e);if(!l||!l.plants[t])throw Error("Plant not found for deletion.");let{["".concat(t)]:s,...o}=l.plants,i=l.deskPlantIds.map(e=>e===t?null:e),d=l.gardenPlantIds.map(e=>e===t?null:e),c=l.collectionPlantIds.filter(e=>e!==t),w=l.showcasePlantIds.filter(e=>e!==t);await (0,n.mZ)(a,{plants:o,deskPlantIds:i,gardenPlantIds:d,collectionPlantIds:c,showcasePlantIds:w})}async function P(e,t){let a=(0,n.H9)(r.db,"users",e);await (0,n.mZ)(a,{showcasePlantIds:t})}async function E(e,t){let a=(0,n.H9)(r.db,"users",e),l=(0,n.H9)(r.db,"users",t),s=await u(e);if(!s)throw Error("Liker data not found.");if(e===t)throw Error("You cannot like yourself.");let o=Date.now(),i=s.likedUsers[t];if(i&&o-i<864e5)throw Error("You have already liked this user today.");let d=(0,n.wP)(r.db);d.update(a,{["likedUsers.".concat(t)]:o}),d.update(l,{likes:(0,n.GV)(1),gold:(0,n.GV)(5)}),await d.commit()}async function D(e,t){let a=(0,n.H9)(r.db,"users",e),l=await u(e);if(!l||l.gold<t)throw Error("Not enough gold to purchase.");await (0,n.mZ)(a,{gold:(0,n.GV)(-t),waterRefillCount:(0,n.GV)(1)})}async function H(e,t){let a=(0,n.H9)(r.db,"users",e),l=await u(e);if(!l||l.rubyCount<t)throw Error("Not enough rubies to purchase.");await (0,n.mZ)(a,{rubyCount:(0,n.GV)(-t),plantChatTokens:(0,n.GV)(1)})}async function U(e,t){let a=(0,n.H9)(r.db,"users",e),l=await u(e);if(!l||l.plantChatTokens<=0)throw Error("You don't have a Plant Chat token to use.");let s=l.plants[t];if(!s)throw Error("Plant not found.");if(s.chatEnabled)throw Error("Chat is already unlocked for this plant.");await (0,n.mZ)(a,{plantChatTokens:(0,n.GV)(-1),["plants.".concat(t,".chatEnabled")]:!0})}async function V(e,t,a,l){let s=(0,n.H9)(r.db,"users",e);await (0,n.mZ)(s,{["plants.".concat(t,".conversationHistory")]:(0,n.hq)({role:"user",content:a},{role:"model",content:l})})}async function x(e,t){let a=(0,n.H9)(r.db,"users",e),l=await u(e);if(!l||!l.seeds)return;let s=l.seeds.find(e=>e.id===t);s&&await (0,n.mZ)(a,{seeds:(0,n.C3)(s)})}async function Z(e,t){let a=(0,n.H9)(r.db,"users",e),l=await u(e);if(!l||l.fertilizerCount<=0)throw Error("No fertilizer available.");let s=l.seeds.find(e=>e.id===t);if(!s)throw Error("Seed not found.");let o=s.startTime-288e5,i=l.seeds.map(e=>e.id===t?{...e,startTime:o}:e);await (0,n.mZ)(a,{fertilizerCount:(0,n.GV)(-1),seeds:i})}},9689:(e,t,a)=>{a.d(t,{G:()=>o,n:()=>i});var n=a(5155),r=a(2115);let l=(0,r.createContext)(void 0),s={tap:"/sfx/tap.mp3",whoosh:"/sfx/whoosh.mp3",chime:"/sfx/chime.mp3",success:"/sfx/success.mp3",reward:"/sfx/reward.mp3",watering:"/sfx/watering.mp3",pickup:"/sfx/pick-up.mp3"},o=e=>{let{children:t}=e,[a,o]=(0,r.useState)(.75),i=(0,r.useRef)([]),d=(0,r.useRef)(0);(0,r.useEffect)(()=>{i.current=Array.from({length:3},()=>new Audio)},[]);let u=(0,r.useCallback)(e=>{o(Math.max(0,Math.min(1,e)))},[]),c=(0,r.useCallback)(e=>{if(a>0&&s[e]&&i.current.length>0){let t=i.current[d.current];d.current=(d.current+1)%3,t.src=s[e],t.volume=a,t.play().catch(e=>console.error("SFX play failed:",e))}},[a]);return(0,n.jsx)(l.Provider,{value:{sfxVolume:a,setSfxVolume:u,playSfx:c},children:t})},i=()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAudio must be used within an AudioProvider");return e}}}]);